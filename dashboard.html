<!DOCTYPE html>
<!--
  EasyADSB Dashboard
  Version: 1.1.0
  Last Updated: 2025-11-29
  
  An automated multi-feeder setup for ADS-B enthusiasts
  
  Built with:
  - ultrafeeder (github.com/sdr-enthusiasts/docker-adsb-ultrafeeder)
  - fr24feed, piaware, radarbox Docker containers
  - tar1090 web interface
  
  Features:
  - Real-time aircraft tracking
  - Multi-feed station management
  - Dark mode with system auto-detection
  - Stealth mode for screenshots/streaming
  - Mobile responsive design
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyADSB Dashboard v1.0.0</title>
    <style>
        :root {
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --card-bg: white;
            --text-primary: #333;
            --text-secondary: #666;
            --accent-color: #667eea;
            --shadow: rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --card-bg: #0f3460;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --accent-color: #667eea;
            --shadow: rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
            position: relative;
            overflow-x: hidden;
            color: var(--text-primary);
        }

        h2 {
            color: var(--text-primary);
        }

        strong {
            color: var(--text-primary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px var(--shadow);
            transition: transform 0.2s, box-shadow 0.3s, background 0.3s;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-icon {
            font-size: 1.5em;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-online {
            background: #10b981;
            color: white;
        }

        .status-offline {
            background: #ef4444;
            color: white;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .card-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .card-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .card-link {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.9em;
            transition: background 0.2s;
            cursor: pointer;
            border: none;
        }

        .card-link:hover {
            background: #5568d3;
        }

        .card-link.secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .card-link.secondary:hover {
            background: #d1d5db;
        }

        .local-map {
            grid-column: 1 / -1;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px var(--shadow);
            transition: background 0.3s;
        }

        .local-map h2 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .map-frame {
            width: 100%;
            height: 60vh;
            min-height: 300px;
            max-height: 800px;
            border: none;
            border-radius: 8px;
            background: #f3f4f6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        [data-theme="dark"] .stat-box {
            background: rgba(255,255,255,0.1);
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
        }

        [data-theme="dark"] .stat-value {
            color: #a5b4fc;  /* Lighter purple for dark mode */
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* Code elements in tips */
        code {
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        [data-theme="dark"] code {
            background: rgba(255,255,255,0.2);
            color: #e9ecef;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px 0;
            color: #999;
            font-size: 0.85em;
            border-top: 1px solid #eee;
        }

        [data-theme="dark"] .footer {
            color: #adb5bd;
            border-top-color: rgba(255,255,255,0.1);
        }

        .footer a {
            color: #667eea;
            text-decoration: none;
        }

        [data-theme="dark"] .footer a {
            color: #a5b4fc;
        }

        /* Tip boxes */
        .tip-box {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 6px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        [data-theme="dark"] .tip-box {
            background: rgba(102, 126, 234, 0.2);
            color: var(--text-primary);
        }

        /* Station ID boxes */
        .id-box {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 8px;
            transition: transform 0.2s;
        }

        /* Service logs section */
        .service-logs {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 8px 0;
            user-select: none;
        }

        .logs-header:hover {
            opacity: 0.8;
        }

        .logs-toggle {
            font-size: 0.9em;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .logs-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .logs-content.expanded {
            max-height: 300px;
        }

        .logs-box {
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.75em;
            max-height: 250px;
            overflow-y: auto;
            color: #e9ecef;
            line-height: 1.4;
        }

        [data-theme="dark"] .logs-box {
            background: rgba(0,0,0,0.5);
        }

        .log-line {
            padding: 2px 0;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .log-line.error {
            color: #ff6b6b;
        }

        .log-line.warning {
            color: #ffd93d;
        }

        .log-line.info {
            color: #6bcf7f;
        }

        .restart-btn {
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .restart-btn:hover {
            background: rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
        }

        /* Station ID boxes */
        .id-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            transition: background 0.3s;
        }

        [data-theme="dark"] .id-box {
            background: rgba(255,255,255,0.1);
        }

        .id-label {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        [data-theme="dark"] .id-label {
            color: #a5b4fc;
        }

        .id-value {
            font-family: monospace;
            font-size: 0.85em;
            word-break: break-all;
            flex: 1;
            color: var(--text-primary);
        }

        .info-text {
            margin-top: 10px;
            padding: 10px;
            background: #e0e7ff;
            border-radius: 6px;
            font-size: 0.9em;
            color: #4338ca;
        }

        .info-text a {
            color: #4338ca;
            font-weight: 600;
        }

        .copy-btn {
            background: #667eea;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .copy-btn:hover {
            background: #5568d3;
            transform: scale(1.1);
        }

        .copy-btn:active {
            transform: scale(0.95);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .card {
                padding: 15px;
            }
            
            /* Stack ID boxes on mobile */
            .station-ids-grid {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Tablet: 2 columns */
        @media (min-width: 481px) and (max-width: 768px) {
            .station-ids-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
        
        /* Desktop: 3 columns (default in inline style) */

        .controls-panel {
            grid-column: 1 / -1;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px var(--shadow);
            margin-bottom: 20px;
            transition: background 0.3s;
        }

        .controls-panel h2 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn.restart {
            background: #10b981;
            color: white;
        }

        .control-btn.restart:hover {
            background: #059669;
        }

        .control-btn.stop {
            background: #ef4444;
            color: white;
        }

        .control-btn.stop:hover {
            background: #dc2626;
        }

        .control-btn.logs {
            background: #3b82f6;
            color: white;
        }

        .control-btn.logs:hover {
            background: #2563eb;
        }

        .control-btn.update {
            background: #8b5cf6;
            color: white;
        }

        .control-btn.update:hover {
            background: #7c3aed;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] .modal-content {
            background: var(--card-bg);
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        [data-theme="dark"] .modal-header {
            color: var(--text-primary);
        }

        .modal-body {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .modal-body input[type="text"] {
            background: white;
            color: #333;
            border: 1px solid #ddd;
        }

        [data-theme="dark"] .modal-body input[type="text"] {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .modal-body ol {
            color: var(--text-primary);
        }

        .modal-body a {
            color: #667eea;
        }

        [data-theme="dark"] .modal-body a {
            color: #a5b4fc;
        }

        .command-box {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }

        .modal-footer {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .modal-btn.primary {
            background: #667eea;
            color: white;
        }

        .modal-btn.primary:hover {
            background: #5568d3;
        }

        .modal-btn.secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .modal-btn.secondary:hover {
            background: #d1d5db;
        }

        /* Stealth Mode - Hide ONLY sensitive IDs (not stats) */
        .stealth-mode .id-value {
            filter: blur(8px);
            user-select: none;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚úàÔ∏è EasyADSB Dashboard</h1>
            <p>Monitor your aircraft tracking feeds</p>
            <button onclick="toggleDarkMode()" style="
                position: absolute;
                top: 20px;
                right: 80px;
                background: rgba(255,255,255,0.2);
                border: 2px solid rgba(255,255,255,0.3);
                color: white;
                padding: 10px 15px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1.2em;
                transition: all 0.3s;
            " onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                <span id="theme-icon">üåô</span>
            </button>
            <button onclick="toggleStealthMode()" title="Stealth Mode - Hide IDs for screenshots" style="
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255,255,255,0.2);
                border: 2px solid rgba(255,255,255,0.3);
                color: white;
                padding: 10px 15px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1.2em;
                transition: all 0.3s;
            " onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                <span id="stealth-icon">üëÅÔ∏è</span>
            </button>
        </div>

        <div class="grid">
            <!-- Local tar1090 Map -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="service-icon">üó∫Ô∏è</span>
                        Local Map
                    </span>
                    <span class="status-badge status-online">
                        <span class="status-dot"></span>
                        Active
                    </span>
                </div>
                <div class="card-content">
                    View live aircraft in your area.
                    <div class="card-links">
                        <a href="#" id="tar1090-link" target="_blank" class="card-link">Open Map</a>
                        <a href="#" id="graphs-link" target="_blank" class="card-link secondary">Graphs</a>
                    </div>
                </div>
            </div>

            <!-- ADSBexchange -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="service-icon">üåê</span>
                        ADSBexchange
                    </span>
                    <span class="status-badge status-online">
                        <span class="status-dot"></span>
                        Broadcasting
                    </span>
                </div>
                <div class="card-content">
                    Global unfiltered flight tracking.
                    <div class="card-links">
                        <a href="https://www.adsbexchange.com/myip/" target="_blank" class="card-link">My Stats</a>
                        <button onclick="openAdsbxMap()" class="card-link secondary">Map</button>
                        <button onclick="openAdsbxCoverage()" class="card-link secondary">Coverage Stats</button>
                    </div>
                </div>
            </div>

            <!-- ADSB.lol -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="service-icon">üì°</span>
                        ADSB.lol
                    </span>
                    <span class="status-badge status-online">
                        <span class="status-dot"></span>
                        Broadcasting
                    </span>
                </div>
                <div class="card-content">
                    Community ADS-B aggregator.
                    <div class="card-links">
                        <a href="https://my.adsb.lol/" target="_blank" class="card-link">My Map</a>
                        <a href="https://mlat.adsb.lol/" target="_blank" class="card-link secondary">MLAT Map</a>
                    </div>
                </div>
            </div>

            <!-- FlightAware -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="service-icon">üõ´</span>
                        FlightAware
                    </span>
                    <span class="status-badge status-online">
                        <span class="status-dot"></span>
                        Broadcasting
                    </span>
                </div>
                <div class="card-content">
                    Leading flight tracking service.
                    <div class="info-text" id="piaware-claim-msg" style="display: none;">
                        üí° <a href="https://flightaware.com/adsb/piaware/claim" target="_blank">Claim your feeder</a>
                        <button onclick="dismissClaimMsg()" style="background: none; border: none; color: var(--text-secondary); cursor: pointer; margin-left: 10px;" title="Dismiss">‚úï</button>
                    </div>
                    <div class="card-links">
                        <button onclick="openPiawareStats()" class="card-link">My Stats</button>
                        <a href="https://www.flightaware.com/live/map" target="_blank" class="card-link secondary">SkyAware Map</a>
                    </div>
                </div>
            </div>

            <!-- FlightRadar24 -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="service-icon">üìç</span>
                        FlightRadar24
                    </span>
                    <span class="status-badge status-online">
                        <span class="status-dot"></span>
                        Broadcasting
                    </span>
                </div>
                <div class="card-content">
                    Popular flight tracker.
                    <div class="card-links">
                        <a href="https://www.flightradar24.com/account/data-sharing" target="_blank" class="card-link">My Feeders</a>
                    </div>
                </div>
            </div>

            <!-- RadarBox -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">
                        <span class="service-icon">üì∂</span>
                        RadarBox
                    </span>
                    <span class="status-badge status-online">
                        <span class="status-dot"></span>
                        Broadcasting
                    </span>
                </div>
                <div class="card-content">
                    Aviation data platform.
                    <div class="card-links">
                        <button onclick="openRadarBoxStation()" class="card-link">My Station</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Embedded Local Map -->
        <div class="local-map">
            <h2>üó∫Ô∏è Live Aircraft Map</h2>
            <iframe class="map-frame" id="map-iframe" src="about:blank"></iframe>
        </div>

        <!-- Quick Stats -->
        <div class="card" style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">üìä Quick Stats</h2>
                <span id="stats-update-time" style="font-size: 0.75em; color: var(--text-secondary);"></span>
            </div>
            <div class="stats-grid">
                <div class="stat-box" style="border-left: 4px solid #22c55e;">
                    <div class="stat-value" id="aircraft-count">-</div>
                    <div class="stat-label">‚úàÔ∏è Aircraft Tracked</div>
                </div>
                <div class="stat-box" style="border-left: 4px solid #f97316;">
                    <div class="stat-value" id="messages-count">-</div>
                    <div class="stat-label">üì° Messages/sec</div>
                </div>
                <div class="stat-box" style="border-left: 4px solid #3b82f6;">
                    <div class="stat-value" id="range-max">-</div>
                    <div class="stat-label">üìè Max Range (nm)</div>
                </div>
            </div>
        </div>

        <!-- Recent Aircraft -->
        <div class="card" style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">‚úàÔ∏è Recent Aircraft</h2>
                <span id="aircraft-update-time" style="font-size: 0.75em; color: var(--text-secondary);"></span>
            </div>
            <div id="recent-aircraft" style="max-height: 300px; overflow-y: auto; font-size: 0.9em;">
                <div style="color: var(--text-secondary); text-align: center; padding: 20px;">
                    Loading aircraft data...
                </div>
            </div>
        </div>

        <!-- Station IDs Reference -->
        <div class="card" style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">üîë Your Station IDs</h2>
                <button class="copy-btn" onclick="copyAllIDs()" title="Copy all IDs" style="padding: 8px 12px; font-size: 0.9em;">üìã Copy All</button>
            </div>
            <div style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 15px;">
                Keep these handy for linking accounts and troubleshooting
            </div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;" class="station-ids-grid">
                <div class="id-box">
                    <div class="id-label">ADSBexchange UUID</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="id-value" id="ref-adsbx">-</div>
                        <button class="copy-btn" onclick="copyToClipboard('ref-adsbx')" title="Copy to clipboard">üìã</button>
                    </div>
                </div>
                <div class="id-box">
                    <div class="id-label">ADSB.lol UUID</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="id-value" id="ref-adsblol">-</div>
                        <button class="copy-btn" onclick="copyToClipboard('ref-adsblol')" title="Copy to clipboard">üìã</button>
                    </div>
                </div>
                <div class="id-box">
                    <div class="id-label">RadarBox Key</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="id-value" id="ref-rb-key">-</div>
                        <button class="copy-btn" onclick="copyToClipboard('ref-rb-key')" title="Copy to clipboard">üìã</button>
                    </div>
                </div>
                <div class="id-box">
                    <div class="id-label">RadarBox Serial</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="id-value" id="ref-rb-serial">-</div>
                        <button class="copy-btn" onclick="copyToClipboard('ref-rb-serial')" title="Copy to clipboard">üìã</button>
                    </div>
                </div>
                <div class="id-box">
                    <div class="id-label">FlightRadar24 Key</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="id-value" id="ref-fr24">-</div>
                        <button class="copy-btn" onclick="copyToClipboard('ref-fr24')" title="Copy to clipboard">üìã</button>
                    </div>
                </div>
                <div class="id-box">
                    <div class="id-label">PiAware ID</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="id-value" id="ref-piaware">-</div>
                        <button class="copy-btn" onclick="copyToClipboard('ref-piaware')" title="Copy to clipboard">üìã</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Version Footer -->
        <div class="footer">
            EasyADSB v1.1.0 | 
            <a href="https://github.com/datboip/easyadsb" target="_blank">‚≠ê GitHub</a> | 
            Built with <a href="https://github.com/sdr-enthusiasts/docker-adsb-ultrafeeder" target="_blank">ultrafeeder</a>
        </div>
    </div>

    <!-- Short ID Input Modal -->
    <div id="shortIdModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">üîë ADSBexchange Short ID</div>
            <div class="modal-body">
                <p>To view your coverage map, you need your ADSBexchange <strong>Short ID</strong> (Feed UID).</p>
                <p style="margin-top: 10px;"><strong>How to find it:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Go to <a href="https://www.adsbexchange.com/myip/" target="_blank" style="color: #667eea;">adsbexchange.com/myip</a></li>
                    <li>Look for <strong>"Feed UID"</strong> (example: BtPKRlTdmKjr)</li>
                    <li>Enter it below (it will be saved)</li>
                </ol>
                <div style="margin-top: 20px;">
                    <label for="shortIdInput" style="display: block; margin-bottom: 8px; font-weight: 600;">Short ID (Feed UID):</label>
                    <input type="text" id="shortIdInput" placeholder="BtPKRlTdmKjr" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; font-family: monospace;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeShortIdModal()">Cancel</button>
                <button class="modal-btn primary" onclick="saveShortId()">Save & Open</button>
            </div>
        </div>
    </div>

    <script src="dashboard-config.js"></script>
    
    <script>
        // Dark Mode Toggle
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            const icon = document.getElementById('theme-icon');
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            icon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Stealth Mode - Hide Station IDs for screenshots/streaming
        function toggleStealthMode() {
            const body = document.body;
            const icon = document.getElementById('stealth-icon');
            const isStealthMode = body.classList.contains('stealth-mode');
            
            if (isStealthMode) {
                body.classList.remove('stealth-mode');
                icon.textContent = 'üëÅÔ∏è';
                localStorage.setItem('stealthMode', 'false');
            } else {
                body.classList.add('stealth-mode');
                icon.textContent = 'üîí';
                localStorage.setItem('stealthMode', 'true');
            }
        }

        // Load saved theme or detect system preference
        let savedTheme = localStorage.getItem('theme');
        if (!savedTheme) {
            // Auto-detect from system
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                savedTheme = 'dark';
            } else {
                savedTheme = 'light';
            }
        }
        
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
        }

        // Copy to clipboard function
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            if (text === '-' || text === 'Not configured' || text === 'Generated on first connect') {
                return; // Don't copy placeholder text
            }
            
            // Try modern clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopyFeedback(element);
                }).catch(err => {
                    // Fallback if clipboard API fails
                    fallbackCopy(text, element);
                });
            } else {
                // Fallback for non-HTTPS or older browsers
                fallbackCopy(text, element);
            }
        }
        
        // Fallback copy method using textarea
        function fallbackCopy(text, element) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showCopyFeedback(element);
            } catch (err) {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard. Text: ' + text);
            }
            
            document.body.removeChild(textarea);
        }
        
        // Show copy success feedback
        function showCopyFeedback(element) {
            const btn = element.parentElement.querySelector('.copy-btn');
            const originalText = btn.textContent;
            btn.textContent = '‚úì';
            btn.style.background = '#10b981';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 1500);
        }

        // Copy all IDs to clipboard
        function copyAllIDs() {
            const ids = {
                'ADSBexchange UUID': document.getElementById('ref-adsbx').textContent,
                'ADSB.lol UUID': document.getElementById('ref-adsblol').textContent,
                'RadarBox Key': document.getElementById('ref-rb-key').textContent,
                'RadarBox Serial': document.getElementById('ref-rb-serial').textContent,
                'FlightRadar24 Key': document.getElementById('ref-fr24').textContent,
                'PiAware ID': document.getElementById('ref-piaware').textContent
            };
            
            let text = 'EasyADSB Station IDs:\n\n';
            for (const [label, value] of Object.entries(ids)) {
                if (value && value !== '-' && !value.includes('Not configured') && !value.includes('Check logs')) {
                    text += `${label}: ${value}\n`;
                }
            }
            
            // Use fallback copy method for compatibility
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('‚úì All IDs copied to clipboard!');
                }).catch(err => {
                    fallbackCopyAll(text);
                });
            } else {
                fallbackCopyAll(text);
            }
        }
        
        // Fallback for copying all IDs
        function fallbackCopyAll(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                alert('‚úì All IDs copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            }
            
            document.body.removeChild(textarea);
        }

        // Detect hostname and build tar1090 URL
        const hostname = window.location.hostname;
        const tar1090URL = `http://${hostname}:8080/`;
        
        // Update tar1090 links
        document.getElementById('tar1090-link').href = tar1090URL;
        document.getElementById('graphs-link').href = `${tar1090URL}graphs1090/`;
        
        // Load the map
        document.getElementById('map-iframe').src = tar1090URL;

        // Initialize config
        let config = {};
        
        // Try to load from generated config file
        if (typeof window.FEEDER_CONFIG !== 'undefined') {
            config = window.FEEDER_CONFIG;
            localStorage.setItem('adsbConfig', JSON.stringify(config));
        } else {
            // Fall back to localStorage
            const saved = localStorage.getItem('adsbConfig');
            if (saved) {
                config = JSON.parse(saved);
            }
        }

        // ADSBexchange Map - requires Short ID
        function openAdsbxMap() {
            let shortId = config.adsbxShortID;
            if (!shortId || shortId === '') {
                showShortIdModal('map');
            } else {
                window.open(`https://globe.adsbexchange.com/?feed=${shortId}`, '_blank');
            }
        }

        // ADSBexchange Coverage Stats - requires Short ID
        function openAdsbxCoverage() {
            let shortId = config.adsbxShortID;
            if (!shortId || shortId === '') {
                showShortIdModal('coverage');
            } else {
                const timestamp = Date.now();
                window.open(`https://www.adsbexchange.com/api/feeders/?feed=${shortId}&t=${timestamp}`, '_blank');
            }
        }

        // FlightAware Stats - uses PiAware ID
        function openPiawareStats() {
            let piawareID = config.piawareID;
            if (!piawareID || piawareID === 'YOUR-PIAWARE-FEEDER-ID' || piawareID === '') {
                alert('PiAware ID not configured.\n\nYour PiAware ID is in your .env file as PIAWARE_FEEDER_ID');
            } else {
                window.open(`https://flightaware.com/adsb/stats/user/${piawareID}`, '_blank');
            }
        }

        // Dismiss claim feeder message
        function dismissClaimMsg() {
            document.getElementById('piaware-claim-msg').style.display = 'none';
            localStorage.setItem('piaware-claim-dismissed', 'true');
        }

        // Open coverage links - prompt for key if not available
        function openCoverageLink(service) {
            let key, url;
            
            switch(service) {
                case 'adsbx':
                    // ADSBexchange coverage requires "Short ID" not UUID
                    // Short IDs look like: BtPKRlTdmKjr (from myip page)
                    let shortId = config.adsbxShortID;
                    
                    if (!shortId || shortId === '') {
                        showShortIdModal();
                    } else {
                        window.open(`https://www.adsbexchange.com/api/feeders/?feed=${shortId}`, '_blank');
                    }
                    break;
                    
                case 'piaware':
                    key = config.piawareID;
                    if (!key || key === 'YOUR-PIAWARE-FEEDER-ID' || key === '') {
                        key = prompt('Enter your FlightAware username:\n\n(Your username from flightaware.com)');
                        if (key) {
                            config.piawareID = key;
                            localStorage.setItem('adsbConfig', JSON.stringify(config));
                        }
                    }
                    if (key && key !== 'YOUR-PIAWARE-FEEDER-ID') {
                        window.open(`https://flightaware.com/adsb/stats/user/${key}`, '_blank');
                    }
                    break;
            }
        }
        
        // RadarBox station link using serial
        function openRadarBoxStation() {
            let serial = config.radarboxSerial;
            
            if (!serial || serial === '' || serial === 'YOUR-RADARBOX-SERIAL') {
                serial = prompt('Enter your RadarBox station serial:\n\n(Find in Station IDs section below or in logs: docker compose logs radarbox | grep "serial")');
                if (serial) {
                    config.radarboxSerial = serial;
                    localStorage.setItem('adsbConfig', JSON.stringify(config));
                    document.getElementById('ref-rb-serial').textContent = serial;
                }
            }
            
            if (serial && serial !== 'YOUR-RADARBOX-SERIAL') {
                window.open(`https://www.radarbox.com/stations/${serial}`, '_blank');
            }
        }

        // Show command modal
        // Short ID Modal Functions
        let shortIdModalContext = 'coverage';  // Default context
        
        function showShortIdModal(context = 'coverage') {
            shortIdModalContext = context;  // Save context for later
            document.getElementById('shortIdModal').classList.add('active');
            document.getElementById('shortIdInput').value = config.adsbxShortID || '';
            // Focus the input
            setTimeout(() => document.getElementById('shortIdInput').focus(), 100);
        }

        function closeShortIdModal() {
            document.getElementById('shortIdModal').classList.remove('active');
        }

        function saveShortId() {
            const shortId = document.getElementById('shortIdInput').value.trim();
            if (shortId) {
                config.adsbxShortID = shortId;
                localStorage.setItem('adsbConfig', JSON.stringify(config));
                closeShortIdModal();
                
                // Open appropriate URL based on context
                const timestamp = Date.now();
                if (shortIdModalContext === 'map') {
                    window.open(`https://globe.adsbexchange.com/?feed=${shortId}`, '_blank');
                } else {
                    window.open(`https://www.adsbexchange.com/api/feeders/?feed=${shortId}&t=${timestamp}`, '_blank');
                }
            } else {
                alert('Please enter a Short ID');
            }
        }

        // Close Short ID modal on background click
        document.getElementById('shortIdModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeShortIdModal();
            }
        });

        // Handle Enter key in Short ID input
        document.getElementById('shortIdInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                saveShortId();
            }
        });

        // Fetch stats from tar1090
        async function updateStats() {
            try {
                const response = await fetch(`${tar1090URL}data/aircraft.json`);
                const data = await response.json();
                
                const aircraftCount = data.aircraft?.length || 0;
                document.getElementById('aircraft-count').textContent = aircraftCount;
                document.getElementById('messages-count').textContent = (data.messages / 1000).toFixed(1) + 'k';
                
                // Calculate max range
                let maxRange = 0;
                data.aircraft?.forEach(ac => {
                    if (ac.seen_pos < 60 && ac.r_dst) {
                        maxRange = Math.max(maxRange, ac.r_dst);
                    }
                });
                document.getElementById('range-max').textContent = maxRange > 0 ? maxRange.toFixed(1) : '-';
                
                // Update timestamp
                const now = new Date();
                const seconds = Math.floor((Date.now() - window.lastStatsUpdate) / 1000) || 0;
                window.lastStatsUpdate = Date.now();
                document.getElementById('stats-update-time').textContent = seconds < 2 ? 'Just now' : `Updated ${seconds}s ago`;
                
                // Update feed status - if we're getting data, feeds are working
                if (aircraftCount > 0) {
                    updateFeedStatus('online');
                }
            } catch (e) {
                console.log('Could not fetch stats:', e);
                updateFeedStatus('offline');
            }
        }

        // Update feed status indicators
        function updateFeedStatus(status) {
            const badges = document.querySelectorAll('.status-badge');
            badges.forEach(badge => {
                if (status === 'online') {
                    badge.classList.remove('status-offline');
                    badge.classList.add('status-online');
                    badge.innerHTML = '<span class="status-dot"></span>Broadcasting';
                } else {
                    badge.classList.remove('status-online');
                    badge.classList.add('status-offline');
                    badge.innerHTML = '<span class="status-dot"></span>Checking...';
                }
            });
        }

        // Populate reference IDs
        function updateReferenceIDs() {
            document.getElementById('ref-adsbx').textContent = config.adsbxUUID || 'Not configured';
            document.getElementById('ref-adsblol').textContent = config.adsbLolUUID || config.adsblolUUID || 'Not configured';  // Support both naming
            document.getElementById('ref-rb-key').textContent = config.radarboxKey || 'Not configured';
            
            // RadarBox Serial - show helper if not available
            const rbSerialEl = document.getElementById('ref-rb-serial');
            if (config.radarboxSerial && config.radarboxSerial !== '' && config.radarboxSerial !== 'YOUR-RADARBOX-KEY') {
                rbSerialEl.textContent = config.radarboxSerial;
            } else {
                rbSerialEl.innerHTML = '<span style="color: var(--text-secondary); font-size: 0.85em;">Check logs: docker compose logs radarbox | grep "serial"</span>';
            }
            
            document.getElementById('ref-fr24').textContent = config.fr24Key || 'Not configured';
            document.getElementById('ref-piaware').textContent = config.piawareID || 'Not configured';
        }

        // Update recent aircraft list
        async function updateRecentAircraft() {
            try {
                const response = await fetch(`${tar1090URL}data/aircraft.json`);
                const data = await response.json();
                
                const aircraftList = document.getElementById('recent-aircraft');
                const updateTime = document.getElementById('aircraft-update-time');
                
                if (!data.aircraft || data.aircraft.length === 0) {
                    aircraftList.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 20px;">No aircraft detected</div>';
                    return;
                }
                
                // Sort by last seen (most recent first) and take top 10
                const recentAircraft = data.aircraft
                    .filter(ac => ac.flight || ac.hex)
                    .sort((a, b) => (a.seen || 999) - (b.seen || 999))
                    .slice(0, 10);
                
                if (recentAircraft.length === 0) {
                    aircraftList.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 20px;">No aircraft with position data</div>';
                    return;
                }
                
                let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';
                
                recentAircraft.forEach(aircraft => {
                    const flight = (aircraft.flight || aircraft.hex || 'Unknown').trim();
                    const alt = aircraft.alt_baro ? `${aircraft.alt_baro}ft` : '-';
                    const dist = aircraft.r_dst ? `${aircraft.r_dst.toFixed(1)}nm` : '-';
                    const seen = aircraft.seen < 60 ? `${Math.floor(aircraft.seen)}s` : `${Math.floor(aircraft.seen / 60)}m`;
                    
                    html += `
                        <div style="display: flex; justify-content: space-between; padding: 6px 10px; background: rgba(255,255,255,0.05); border-radius: 4px; font-size: 0.9em;">
                            <span style="color: var(--text-primary); font-weight: 500;">${flight}</span>
                            <span style="color: var(--text-secondary);">${alt} ‚Ä¢ ${dist} ‚Ä¢ ${seen}</span>
                        </div>
                    `;
                });
                
                html += '</div>';
                aircraftList.innerHTML = html;
                
                const now = new Date();
                updateTime.textContent = `Updated ${now.toLocaleTimeString()}`;
            } catch (error) {
                console.error('Error fetching aircraft data:', error);
            }
        }

        // Initialize
        window.lastStatsUpdate = Date.now();
        updateReferenceIDs();
        updateStats();
        updateRecentAircraft(); // Initial load
        setInterval(updateStats, 5000);
        setInterval(updateRecentAircraft, 5000); // Update aircraft every 5 seconds
        
        // Show PiAware claim message if not dismissed
        if (localStorage.getItem('piaware-claim-dismissed') !== 'true') {
            document.getElementById('piaware-claim-msg').style.display = 'block';
        }
        
        // Restore stealth mode state
        if (localStorage.getItem('stealthMode') === 'true') {
            document.body.classList.add('stealth-mode');
            document.getElementById('stealth-icon').textContent = 'üîí';
        }
    </script>
</body>
</html>
